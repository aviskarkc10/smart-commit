#!/usr/bin/env bash
set -euo pipefail

IS_IGNORED=false
IGNORED_PATH="./.ignore"
CURRENT_BRANCH="$(git rev-parse --abbrev-ref HEAD)"
IGNORED_BRANCHES=("dev" "master" "qa" "uat" "staging")

colorEcho(){
    RED="\033[0;31m"
    GREEN='\033[0;32m'
    YELLOW='\033[1;33m'
    NO_COLOR='\033[0m'
    printf "${!1}${2} ${NO_COLOR}\n"
}

commitWithBranch() {
    colorEcho "GREEN" "Commit translation: \"$CURRENT_BRANCH: $1\""
    # Edit your config here
    git commit -m "$CURRENT_BRANCH: $1"
}

if [[ -f "$IGNORED_PATH" ]]
then
    CUSTOM_BRANCHES=$(cat "$IGNORED_PATH")
    BRANCHES=( $CUSTOM_BRANCHES )
    IGNORED_BRANCHES=( ${IGNORED_BRANCHES[@]} ${BRANCHES[@]} )
    colorEcho "YELLOW" "Excluding branches from .ignore file."
else
    colorEcho "YELLOW" ".ignore file not found, excluding default branches."
fi

for branch in "${IGNORED_BRANCHES[@]}"
    do
        if [ "$CURRENT_BRANCH" == $branch ]
        then
            IS_IGNORED=true
	    break
	fi
done


if [ "$IS_IGNORED" == false ]
then
    commitWithBranch $1
else
    colorEcho "GREEN" "Commit translation: \"$1\""
    git commit -m "$1"
fi
